LIBNAME OUT 'C:\Projetos\RMs Proc. 03605.001726-2014-52 - FJP Maria Luiza Marques\Maceio\Vulnerabilidade\2000\Agregacoes';
LIBNAME IN 'C:\Projetos\Projeto Proc. 03605.001349-2012-90 - FJP Maria Luiza Marques\Programas\Vulnerabilidade\2000';

 OPTIONS PS=10000 NODATE LS=250 OBS=MAX;


DATA SETOR;
SET IN.vul00;


UF=SUBSTR(SETORC,1,2);
IF UF='27';*AL;


*** VULNERABILIDADE ***;
IF M10A14CF=. THEN M10A14CF=0;
IF M15A17CF=. THEN M15A17CF=0;
IF POPMU10A14=. THEN POPMU10A14=0;
IF POPMU15A17=. THEN POPMU15A17=0;
IF POPMU10M=. THEN POPMU10M=0;
IF MULCHEFEFUNDINFDOM=. THEN MULCHEFEFUNDINFDOM=0;
IF OCUPM15=. THEN OCUPM15=0;
IF POP10A14=. THEN POP10A14=0;
IF CRIFUNDIN_TODOS=. THEN CRIFUNDIN_TODOS=0;
IF POPM15=. THEN POPM15=0;
IF OCUP=. THEN OCUP=0;
IF FUNDIN_TODOS=. THEN FUNDIN_TODOS=0;
IF POP=. THEN POP=0;
IF NESTUDA_NTRAB_MMEIO=. THEN NESTUDA_NTRAB_MMEIO=0;
IF POP15A24=. THEN POP15A24=0;
IF FUNDIN18MINF=. THEN FUNDIN18MINF=0;
IF POP18M=. THEN POP18M=0;
IF FUNDIN_TODOS_MMEIO=. THEN FUNDIN_TODOS_MMEIO=0;
IF RMAXIDOSO=. THEN RMAXIDOSO=0;




/* IMPORTACAO DO ARQUIVO CONTENDO O DIVISOR  */
PROC IMPORT OUT= WORK.DIV_A
            DATAFILE= "C:\Projetos\RMs Proc. 03605.001726-2014-52 - FJP Maria Luiza Marques\Base_mae\Maceio\DIV_mun00.txt"
            DBMS=TAB REPLACE;
     GETNAMES=YES;
     DATAROW=2;
RUN;


/* IMPORTACAO DO ARQUIVO CONTENDO BASE MAE */
PROC IMPORT OUT= WORK.MAE_A
            DATAFILE= "C:\Projetos\RMs Proc. 03605.001726-2014-52 - FJP Maria Luiza Marques\Base_mae\Maceio\MAE_mun00.txt"
            DBMS=TAB REPLACE;
     GETNAMES=YES;
     DATAROW=2;
RUN;




DATA MAE_A(KEEP=SETORC MUN10);
SET MAE_A;


setor=PUT(Setor_2000,15.);
set1=substr(Setor,1,6);
set11=put(set1,6.);
set2=substr(Setor,8,8);
set22=put(set2,8.);
SETORC=set11!!set22;



MUN10=Cod_Mun10_2000;



PROC SORT DATA=MAE_A;
BY SETORC;



DATA DIV_A (KEEP=SETORC DIVPESO);
SET DIV_A;


setor=PUT(Setor_2000,15.);
set1=substr(Setor,1,6);
set11=put(set1,6.);
set2=substr(Setor,8,8);
set22=put(set2,8.);
SETORC=set11!!set22;



DIVPESO=Div_Mun10_00;


PROC SORT DATA=DIV_A;
BY SETORC;


DATA DIVMAE;
MERGE MAE_A(IN=A) DIV_A(IN=B);
IF A AND B;
BY SETORC;run;


DATA DIVMAE(DROP= DIVPESO);
SET DIVMAE;

RETAIN D(0);
 IF FIRST.SETORC THEN DO;
  D=0;
 BY SETORC;
END;

D=D+1;


DATA UMO;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=1;

D=1;

DATA DEDOS;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=2;

DATA DEDOS;
SET DEDOS DEDOS;

PROC SORT DATA=DEDOS;
BY SETORC;

DATA DEDOS;
SET DEDOS;

RETAIN D(0);
  IF FIRST.SETORC THEN DO;
  D=0;
  BY SETORC;
END;

D=D+1;


DATA DETRE;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=3;

DATA DETRE;
SET DETRE DETRE DETRE;

PROC SORT DATA=DETRE;
BY SETORC ;

DATA DETRE;
SET DETRE;

RETAIN D(0);
  IF FIRST.SETORC THEN DO;
  D=0;
  BY SETORC ;
END;

D=D+1;

DATA DECUA;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=4;

DATA DECUA;
SET DECUA DECUA DECUA DECUA;

PROC SORT DATA=DECUA;
BY SETORC ;

DATA DECUA;
SET DECUA;

RETAIN D(0);
  IF FIRST.SETORC THEN DO;
  D=0;
  BY SETORC ;
END;

D=D+1;


DATA DECIN;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=5;

DATA DECIN;
SET DECIN DECIN DECIN DECIN DECIN;

PROC SORT DATA=DECIN;
BY SETORC ;

DATA DECIN;
SET DECIN;

RETAIN D(0);
  IF FIRST.SETORC THEN DO;
  D=0;
  BY SETORC ;
END;

D=D+1;


DATA DESEI;
MERGE SETOR(IN=A) DIV_A(IN=B);
IF A;
BY SETORC;

IF DIVPESO=6;

DATA DESEI;
SET DESEI DESEI DESEI DESEI DESEI DESEI;

PROC SORT DATA=DESEI;
BY SETORC ;

DATA DESEI;
SET DESEI;

RETAIN D(0);
  IF FIRST.SETORC THEN DO;
  D=0;
  BY SETORC ;
END;

D=D+1;


DATA SETOR;
SET UMO DEDOS DETRE DECUA DECIN DESEI;


PROC SORT DATA=SETOR;
BY SETORC D;

PROC SORT DATA=DIVMAE;
BY SETORC D;


DATA SETOR;
MERGE SETOR(IN=A) DIVMAE(IN=B);
IF A AND B;
BY SETORC D;



PROC MEANS DATA=SETOR SUM;
VAR POP;



DATA SETOR(DROP=M10A14CF M15A17CF POPMU10A14 POPMU15A17 POPMU10M MULCHEFEFUNDINFDOM OCUPM15 OCUP POP10A14 CRIFUNDIN_TODOS
                POPM15 FUNDIN_TODOS POP NESTUDA_NTRAB_MMEIO POP15A24 FUNDIN18MINF POP18M FUNDIN_TODOS_MMEIO RMAXIDOSO);
SET SETOR;



IF M10A14CF=. THEN M10A14CF=0;
IF M15A17CF=. THEN M15A17CF=0;
IF POPMU10A14=. THEN POPMU10A14=0;
IF POPMU15A17=. THEN POPMU15A17=0;
IF POPMU10M=. THEN POPMU10M=0;
IF MULCHEFEFUNDINFDOM=. THEN MULCHEFEFUNDINFDOM=0;
IF OCUPM15=. THEN OCUPM15=0;
IF POP10A14=. THEN POP10A14=0;
IF CRIFUNDIN_TODOS=. THEN CRIFUNDIN_TODOS=0;
IF POPM15=. THEN POPM15=0;
IF OCUP=. THEN OCUP=0;
IF FUNDIN_TODOS=. THEN FUNDIN_TODOS=0;
IF POP=. THEN POP=0;
IF NESTUDA_NTRAB_MMEIO=. THEN NESTUDA_NTRAB_MMEIO=0;
IF POP15A24=. THEN POP15A24=0;
IF FUNDIN18MINF=. THEN FUNDIN18MINF=0;
IF POP18M=. THEN POP18M=0;
IF FUNDIN_TODOS_MMEIO=. THEN FUNDIN_TODOS_MMEIO=0;
IF RMAXIDOSO=. THEN RMAXIDOSO=0;


DM10A14CF=M10A14CF/DIVPESO;
DM15A17CF=M15A17CF/DIVPESO;
DPOPMU10A14=POPMU10A14/DIVPESO;
DPOPMU15A17=POPMU15A17/DIVPESO;
DPOPMU10M=POPMU10M/DIVPESO;
DMULCHEFEFUNDINFDOM=MULCHEFEFUNDINFDOM/DIVPESO;
DOCUPM15=OCUPM15/DIVPESO;
DPOP10A14=POP10A14/DIVPESO;
DCRIFUNDIN_TODOS=CRIFUNDIN_TODOS/DIVPESO;
DPOPM15=POPM15/DIVPESO;
DOCUP=OCUP/DIVPESO;
DFUNDIN_TODOS=FUNDIN_TODOS/DIVPESO;
DPOP=POP/DIVPESO;
DNESTUDA_NTRAB_MMEIO=NESTUDA_NTRAB_MMEIO/DIVPESO;
DPOP15A24=POP15A24/DIVPESO;
DFUNDIN18MINF=FUNDIN18MINF/DIVPESO;
DPOP18M=POP18M/DIVPESO;
DFUNDIN_TODOS_MMEIO=FUNDIN_TODOS_MMEIO/DIVPESO;
DRMAXIDOSO=RMAXIDOSO/DIVPESO;



PROC MEANS DATA=SETOR SUM;
VAR DPOP;


******************************** CALCULANDO OS INDICADORES - MUN10 ********************************;

DATA SETOR(DROP=DM10A14CF DM15A17CF DPOPMU10A14 DPOPMU15A17 DPOPMU10M DMULCHEFEFUNDINFDOM DOCUPM15 DPOP10A14 DCRIFUNDIN_TODOS
                DPOPM15 DOCUP DFUNDIN_TODOS DPOP DNESTUDA_NTRAB_MMEIO DPOP15A24 DFUNDIN18MINF DPOP18M DFUNDIN_TODOS_MMEIO DRMAXIDOSO);
 SET SETOR;




M10A14CF=DM10A14CF;
M15A17CF=DM15A17CF;
POPMU10A14=DPOPMU10A14;
POPMU15A17=DPOPMU15A17;
POPMU10M=DPOPMU10M;
MULCHEFEFUNDINFDOM=DMULCHEFEFUNDINFDOM;
OCUPM15=DOCUPM15;
POP10A14=DPOP10A14;
CRIFUNDIN_TODOS=DCRIFUNDIN_TODOS;
POPM15=DPOPM15;
OCUP=DOCUP;
FUNDIN_TODOS=DFUNDIN_TODOS;
POP=DPOP;
NESTUDA_NTRAB_MMEIO=DNESTUDA_NTRAB_MMEIO;
POP15A24=DPOP15A24;
FUNDIN18MINF=DFUNDIN18MINF;
POP18M=DPOP18M;
FUNDIN_TODOS_MMEIO=DFUNDIN_TODOS_MMEIO;
RMAXIDOSO=DRMAXIDOSO;




PROC SORT DATA=SETOR;
BY MUN10;



PROC MEANS DATA=SETOR SUM NOPRINT;
VAR M10A14CF M15A17CF POPMU10A14 POPMU15A17 POPMU10M MULCHEFEFUNDINFDOM OCUPM15 POP10A14 CRIFUNDIN_TODOS
    POPM15 OCUP FUNDIN_TODOS POP NESTUDA_NTRAB_MMEIO POP15A24 FUNDIN18MINF POP18M FUNDIN_TODOS_MMEIO RMAXIDOSO;
OUTPUT OUT=SOMA1 (KEEP=MUN10 M10A14CF M15A17CF POPMU10A14 POPMU15A17 POPMU10M MULCHEFEFUNDINFDOM OCUPM15 POP10A14 CRIFUNDIN_TODOS
                       POPM15 FUNDIN_TODOS POP NESTUDA_NTRAB_MMEIO POP15A24 FUNDIN18MINF POP18M FUNDIN_TODOS_MMEIO RMAXIDOSO)
       SUM=M10A14CF M15A17CF POPMU10A14 POPMU15A17 POPMU10M MULCHEFEFUNDINFDOM OCUPM15 POP10A14 CRIFUNDIN_TODOS
           POPM15 OCUP FUNDIN_TODOS POP NESTUDA_NTRAB_MMEIO POP15A24 FUNDIN18MINF POP18M FUNDIN_TODOS_MMEIO RMAXIDOSO;
BY MUN10;



DATA FINAL;
SET SOMA1;




*** VULNERABILIDADE ***;

IF POPMU10A14>0 THEN T_M10A14CF=(M10A14CF/POPMU10A14)*100;
ELSE                 T_M10A14CF=0;

IF POPMU15A17>0 THEN T_M15A17CF=(M15A17CF/POPMU15A17)*100;
ELSE                 T_M15A17CF=0;

IF POPMU10M>0 THEN T_MULCHEFEFIF014=(MULCHEFEFUNDINFDOM/POPMU10M)*100;
ELSE               T_MULCHEFEFIF014=0;


IF POP10A14>0 THEN T_OCUPM15=(OCUPM15/POP10A14)*100;
ELSE               T_OCUPM15=0;

IF POPM15>0 THEN T_CRIFUNDIN_TODOS=(CRIFUNDIN_TODOS/POPM15)*100;
ELSE             T_CRIFUNDIN_TODOS=0;

IF POP>0 THEN T_FUNDIN_TODOS=(FUNDIN_TODOS/POP)*100;
ELSE          T_FUNDIN_TODOS=0;

IF POP15A24>0 THEN T_NESTUDA_NTRAB_MMEIO=(NESTUDA_NTRAB_MMEIO/POP15A24)*100;
ELSE               T_NESTUDA_NTRAB_MMEIO=0;

IF POP18M>0 THEN T_FUNDIN18MINF=(FUNDIN18MINF/POP18M)*100;
ELSE             T_FUNDIN18MINF=0;

IF POP>0 THEN T_FUNDIN_TODOS_MMEIO=(FUNDIN_TODOS_MMEIO/POP)*100;
ELSE          T_FUNDIN_TODOS_MMEIO=0;

IF POP>0 THEN T_RMAXIDOSO=(RMAXIDOSO/POP)*100;
ELSE          T_RMAXIDOSO=0;




*** GRAVACAO ***;

DATA OUT.VUL00_MUN10;
SET FINAL;
RUN;


************************************;
*** IMPORTANDO A BASE PARA EXCEL ***;
************************************;

PROC DBLOAD DBMS=EXCEL DATA= OUT.VUL00_MUN10;
PATH='C:\Projetos\RMs Proc. 03605.001726-2014-52 - FJP Maria Luiza Marques\Maceio\Vulnerabilidade\2000\Agregacoes\VUL00_MUN10.XLS';
PUTNAMES=YES;
LIMIT=0;
LOAD;




RUN;
