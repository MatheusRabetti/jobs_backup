LIBNAME OUT 'C:\Projetos\RMs Proc. 03605.001403-2013-88 - FJP Maria Luiza Marques\Maceio\Vulnerabilidade\2010';
LIBNAME IN 'C:\Projetos\RMs Proc. 03605.001403-2013-88 - FJP Maria Luiza Marques\Base dom e pes 2010';
LIBNAME IN2 'C:\Projetos\RMs Proc. 03605.001403-2013-88 - FJP Maria Luiza Marques\Renda imputada FJP 2010';


DATA IBGE;
SET IN.pesdom10;


IF V0001='27';*AL;


 SETORC=V0000;


 IDDOM=V0300;


DATA RDPCIMPUT(KEEP=IDDOM RDPC_IMPUT);
SET IN2.imputado_br_2010_primeiro;


PROC SORT DATA=RDPCIMPUT;
BY IDDOM;



DATA PES;
SET IBGE;


****************;
* PESOP - PESO *;
****************;
PESOPES=V0010;


*** CONTADOR ***;
CONT=1;


*** EXCLUINDO PENSIONISTA, EMPREGADO DOMESTICO E PARENTES DO EMPREGADO ***;

IF 1<=V0502<=16;


*** EXCLUINDO OS DOMICILIOS COLETIVOS ***;
IF V4001=1 OR V4001=2;


********************* SEM FUNDAMENTAL COMPLETO *********************;

 SELECT;
  WHEN (1<=V0629<=6)         FUNDIN=1;
  WHEN (1<=V0633<=3)         FUNDIN=1;
  WHEN (V0633=5)             FUNDIN=1;
  WHEN (V0633=6)             FUNDIN=1;
  WHEN (V0633=4 AND V0634=2) FUNDIN=1;
  WHEN (V0633=7 AND V0634=2) FUNDIN=1;
  WHEN (V0633=8 AND V0634=2) FUNDIN=1;
  WHEN (V0628=4)             FUNDIN=1;
  OTHERWISE                  FUNDIN=0;
 END;


*** MULHERES COM FILHOS ***;


SELECT;
 WHEN ((V6800>0) AND (10<=V6036<=14) AND (V0601=2)) M10A14CF=1;
 OTHERWISE                                          M10A14CF=0;
END;

SELECT;
 WHEN ((V6800>0) AND (15<=V6036<=17) AND (V0601=2)) M15A17CF=1;
 OTHERWISE                                          M15A17CF=0;
END;

SELECT;
 WHEN ((V0601=2) AND (10<=V6036<=14)) POPMU10A14=1;
 OTHERWISE                            POPMU10A14=0;
END;

SELECT;
 WHEN ((V0601=2) AND (15<=V6036<=17)) POPMU15A17=1;
 OTHERWISE                            POPMU15A17=0;
END;



*** MULHER CHEFE ***;


IF (V0502=1 AND V0601=2) THEN MULCHEFE=1;
ELSE                          MULCHEFE=0;


IF (V0502=1 AND V0601=2 AND FUNDIN=1) THEN MULCHEFEFUNDIN=1;
ELSE                                       MULCHEFEFUNDIN=0;



SELECT;
 WHEN (V6036>=10 AND V0601=2) POPMU10M=1;
 OTHERWISE                    POPMU10M=0;
END;


IF (0<=V6036<=14 AND 4<=V0502<=5) THEN F014=1;
ELSE                                   F014=0;


IF (V6036>14) THEN ADULTO=1;
ELSE               ADULTO=0;



*** PESSOAS COM MENOS DE 15 ANOS QUE TRABALHAM ***;


IF (V0641=1 OR V0642=1 OR V0643=1 OR V0644=1) THEN OCUP=1;
ELSE                                               OCUP=0;


SELECT;
 WHEN ((0<=V6036<=14) AND (OCUP=1)) OCUPM15=1;
 OTHERWISE                          OCUPM15=0;
END;



IF (10<=V6036<=14) THEN POP10A14=1;
ELSE                    POP10A14=0;


IF (15<=V6036<=24) THEN POP15A24=1;
ELSE                    POP15A24=0;


IF (V6036>=18) THEN POP18M=1;
ELSE                POP18M=0;


IF (V6036<15) THEN POPM15=1;
ELSE               POPM15=0;



*** NAO FREQUENTA ***;

SELECT;
  WHEN (V0628=1 OR V0628=2)  FREQ=1;
  OTHERWISE                  FREQ=0;
END;


IF FREQ=. THEN FREQ=0;


****************** OCUPADOS ******************;


*******;
* DES *;
*******;

SELECT;
 WHEN (V0641=2 AND V0642=2 AND V0643=2 AND V0644=2 AND V0654=1) DES=1;
 OTHERWISE                                                      DES=0;
END;


*******;
* PEA *;
*******;

SELECT;
 WHEN (OCUP=1 OR DES=1) PEA=1;
 OTHERWISE              PEA=0;
END;


SELECT;
 WHEN ((1<=V0648<=3) OR ((V0648=5 OR V0648=6) AND V0650=1)) FORMAL=1;
 OTHERWISE                                                  FORMAL=0;
END;


IF PEA=0 THEN NPEA=1;
ELSE          NPEA=0;


IF FORMAL=0 THEN INFORMAL=1;
ELSE             INFORMAL=0;




IF (V6036>=65) THEN IDOSO=1;
ELSE                IDOSO=0;


IF V6527=. THEN V6527=0;
IF V6527=9999999 THEN V6527=.;


PROC SORT DATA=PES;
BY IDDOM;


PROC MEANS DATA=PES SUM N NOPRINT;
VAR CONT ADULTO;
OUTPUT OUT=SOMA1(KEEP=IDDOM SCONT ADULTODOM)
       SUM=SCONT ADULTODOM;
BY IDDOM;



PROC MEANS DATA=PES SUM NOPRINT;
VAR MULCHEFEFUNDIN MULCHEFE F014 FUNDIN;
OUTPUT OUT=SOMA2(KEEP=IDDOM P_MULCHEFEFUNDIN P_MULCHEFE P_F014 SFUNDIN)
       SUM=P_MULCHEFEFUNDIN P_MULCHEFE P_F014 SFUNDIN;
BY IDDOM;


DATA VUL;
 MERGE PES(IN=A) SOMA1(IN=B) SOMA2(IN=C) RDPCIMPUT(IN=D);
 IF A;
 BY IDDOM;



RDPC=RDPC_IMPUT;


***** DESLOCAMENTO CASA-TRABALHO MAIOR QUE 1 HORA***somente para 2010 *****;

IF (OCUP=1 AND V0662>=4 AND RDPC<=255) THEN OCUPDESLOC_1=1;
ELSE                                        OCUPDESLOC_1=0;

IF (OCUP=1 AND V0662>=5 AND RDPC<=255) THEN OCUPDESLOC_2=1;
ELSE                                        OCUPDESLOC_2=0;



PROC MEANS DATA=VUL SUM NOPRINT;
VAR RDPC;
OUTPUT OUT=REN(KEEP=IDDOM RENDADOM)
       SUM=RENDADOM;
BY IDDOM;


DATA VUL;
MERGE VUL REN;
BY IDDOM;




****** IMPUTANDO A RENDA PESSOAL ******;

SELECT;
  WHEN ((V6531=0 AND RDPC>0) AND V6036<=14) RENDAP=0;
  WHEN ((V6531=0 AND RDPC>0) AND V6036>14)  RENDAP=RENDADOM/ADULTODOM;
  WHEN ((V6531=0 AND RDPC=0) OR  V6531>0)   RENDAP=V6527;
  OTHERWISE                                 RENDAP=.;
END;



IF (P_MULCHEFEFUNDIN=1 AND P_F014>0) THEN MULCHEFEFUNDINFDOM=1;
ELSE                                      MULCHEFEFUNDINFDOM=0;


IF (SFUNDIN=SCONT)  THEN FUNDIN_TODOS=1;
ELSE                     FUNDIN_TODOS=0;


IF (V6036>=18 AND FUNDIN=1 AND INFORMAL=1) THEN FUNDIN18MINF=1;
ELSE                                            FUNDIN18MINF=0;


IF (FUNDIN_TODOS=1 AND RDPC<=255) THEN FUNDIN_TODOS_MMEIO=1;
ELSE                                   FUNDIN_TODOS_MMEIO=0;



*********** CRIANÃ‡AS ***********;

IF (FUNDIN_TODOS=1 AND V6036<15) THEN CRIFUNDIN_TODOS=1;
ELSE                                  CRIFUNDIN_TODOS=0;


IF (FREQ=0 AND (DES=1 OR NPEA=1) AND RDPC<=255 AND POP15A24=1) THEN NESTUDA_NTRAB_MMEIO=1;
ELSE                                                                NESTUDA_NTRAB_MMEIO=0;


IF ((RENDAP>=RENDADOM*0.5) AND IDOSO=1) THEN MAX_RDPC_IDOSO=1;
ELSE                                         MAX_RDPC_IDOSO=0;



PROC MEANS DATA=VUL SUM NOPRINT;
VAR MAX_RDPC_IDOSO;
OUTPUT OUT=SOMA3(KEEP=IDDOM DOM_IDOSO)
       SUM=DOM_IDOSO;
BY IDDOM;



DATA JUNTO;
MERGE VUL SOMA3;
 BY IDDOM;


*** CONTADOR ***;
CONTADOR=1;



IF (RDPC_IMPUT<=255 AND DOM_IDOSO>=1) THEN RMAXIDOSO=1;
ELSE                                       RMAXIDOSO=0;


PROC SORT DATA=JUNTO;
BY SETORC;


PROC MEANS DATA=JUNTO SUM NOPRINT;
VAR OCUPM15 FUNDIN_TODOS FUNDIN18MINF FUNDIN_TODOS_MMEIO CRIFUNDIN_TODOS NESTUDA_NTRAB_MMEIO RMAXIDOSO
    POP18M POP10A14 POP15A24 POPM15 OCUP CONTADOR M10A14CF M15A17CF MULCHEFEFUNDINFDOM
    POPMU10A14 POPMU15A17 POPMU10M OCUPDESLOC_1 OCUPDESLOC_2;
OUTPUT OUT=SOMA4(KEEP=SETORC OCUPM15 FUNDIN_TODOS FUNDIN18MINF FUNDIN_TODOS_MMEIO CRIFUNDIN_TODOS NESTUDA_NTRAB_MMEIO RMAXIDOSO
                      POP18M POP10A14 POP15A24 POPM15 OCUP POP M10A14CF M15A17CF MULCHEFEFUNDINFDOM
                      POPMU10A14 POPMU15A17 POPMU10M OCUPDESLOC_1 OCUPDESLOC_2)
       SUM=OCUPM15 FUNDIN_TODOS FUNDIN18MINF FUNDIN_TODOS_MMEIO CRIFUNDIN_TODOS NESTUDA_NTRAB_MMEIO RMAXIDOSO
           POP18M POP10A14 POP15A24 POPM15 OCUP POP M10A14CF M15A17CF MULCHEFEFUNDINFDOM
           POPMU10A14 POPMU15A17 POPMU10M OCUPDESLOC_1 OCUPDESLOC_2;
WEIGHT PESOPES;
BY SETORC;



DATA OUT.VUL10;
SET SOMA4;


RUN;
